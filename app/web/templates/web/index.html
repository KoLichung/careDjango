{% extends 'web/base.html' %} {% block content %}
{% load static %}

<main class="main bg-white" id="top" >
      
  <!-- main content -->
  <section class="bg-frontpage-cover">
    
    <div class="bg-text container-fluid col-11 col-sm-10  col-md-7  col-xl-5 my-4 row" >
      
          <span  class="mt-4 mx-3" style="color: white; font-size:30px;"><strong>照護 168 | slogan slogan</strong></span> 
          
          <!-- form content -->
          <form method="post" enctype="multipart/form-data">{% csrf_token %}
            <div class="card bg-white">
              
                <div class="mt-4  mb-3" style="margin: 10px; display: flex;">
                  <div class="segment__item">
                    <input type="radio" class="segment__input"  id="care_type" name="care_type" value="居家照顧" checked>
                    <div class="segment__button" style="font-size: 18px; height: 50px; padding-top: 6px;">居家照顧</div>
                  </div>
            
                  <div class="segment__item">
                    <input type="radio" class="segment__input"  id="care_type" name="care_type" value="醫院看護">
                    <div class="segment__button" style="font-size: 18px; height: 50px; padding-top: 6px;">醫院看護</div>
                  </div>
                </div>

                <!-- 照護地點 -->
                <div class="row">
                  <div class="col-12 col-sm-3 inner title-font">&emsp;照護地點</div>
                  
                  <div class="col-12 col-sm-3 mt-2" style="margin-right: 20px;">
                    <div class="btn-group" >
                      <select class="dropdown-button" name="city" onchange="listCities()">
                        {% for city in dict.citys %}
                          <option style="text-align: center" value="{{city.id}}">{{city}}</option>
                          <!-- <option value="醫院看護">醫院看護</option> -->
                        {% endfor %}
                      </select>
                    </div>
                  </div>
                  
                  <!-- <div  class="col-1 inner" style="color: #BB6BD9;font-size:20px;">|</div> -->
      
                  <div class="col-sm-3 mt-2">
                      <div class="btn-group">
                        <select class="dropdown-button" id="countylist" name="county">
                          {% for county in dict.counties %}
                            <option style="text-align: center" value="全區">全區</option>
                            <option style="text-align: center" value="{{county.id}}">{{county}}</option>
                          {% endfor %}
                        </select>
                      </div>
                  </div>
  
                </div>
              
                  <hr size="4" class="mx-2" style="color: #BB6BD9;"/>

                  <!-- 時間類型 -->
                  <div class="row justify-content-start">
                    <div class="col-12 col-sm-3  inner title-font" >&emsp;時間類型</div>
                    <div class="col-12 col-sm-4">
                      <label class="custom-radio-parent align-self-center" style="margin: 0px;">連續時間
                        <input type="radio" checked="checked" name="is_continuous_time" id="is_continuous_time" value=True onchange="continuous_timeSelect()">
                        <span class="checkmark"></span>
                      </label>
                    </div>
                    <div class="col-12 col-sm-4">
                      <label class="custom-radio-parent align-self-center" style="margin: 0px;">每週時段預定
                        <input type="radio" name="is_continuous_time" id="is_continuous_time" value=False onchange="WeekdaySelect()">
                        <span class="checkmark"></span>
                      </label>
                    </div>
                  </div>
                  <hr size="4" class="mx-2" style="color: #BB6BD9;"/>

                  <!-- 每週時段 -->
                  <div id="time_type_select"></div>
                  
                      
                  <!-- 開始時間 -->
                  <div class="row">
                    <div class="col-12 col-sm-3 inner title-font">&emsp;開始時間</div>
                    <div class="col-12 col-sm-5" >
                      <input class="timePicker-noBorder-button datetimepicker" style="width: 150px;" id="datetimepicker_start" name="datetimepicker_start" type="text" placeholder="年/月/日 時:分" data-options='{"enableTime":true,"dateFormat":"y/m/d H:i","disableMobile":true}' />         
                    </div> 
                  </div>
                  
                  <hr size="4" class="mx-2" style="color: #BB6BD9;"/>
                      
                  <!-- 結束時間 -->
                  <div class="row">
                    <div class="col-12 col-sm-3 title-font inner">&emsp;結束時間</div>
                    <div class="col-12 col-sm-5" >
                      <input class="timePicker-noBorder-button datetimepicker" style="width: 150px;" id="datetimepicker_end" name="datetimepicker_end" type="text" placeholder="年/月/日 時:分" data-options='{"enableTime":true,"dateFormat":"y/m/d H:i","disableMobile":true}' />         
                    </div>
                  </div>
                
                  <br>  
                </div>
              
                <!-- <a href="{% url 'search_list' %}?city_id={{dict.city.id}}&county_id={{dict.county.id}}&care_type={{dict.care_type}}&is_continuous_time={{dict.is_continuous_time}}&start_date={{dict.start_date}}&end_date={{dict.end_date}}"> -->
                <!-- <button class="mt-4 full-purple-button" type="submit">搜尋</button> -->
                <!-- </a> -->

                <button class="mt-4 full-purple-button"
                  type="submit"
                  name="submit"
                  value="ok"
                >
                  <b>搜索</b>
                </button>

                {% comment %} <button class="mt-4 full-purple-button"  id="submit"  onclick="call.call_frontend()" >
                  搜尋
                </button> {% endcomment %}
          </form>
    </div>  
    
  </section>

  <script type="text/javascript">
    function getCookie(name){
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
                  }
              }
          }
          return cookieValue;
      }
      const csrftoken = getCookie('csrftoken');

      function listCities(){
        var cityid = $("[name='city']").val();
        $('#countylist').html('');
        $.ajax({
          type: "POST",
          data: {'city_id':cityid,
                  'action':'refresh_county'},
          headers: {'X-CSRFToken': csrftoken},
          url: "{% url 'ajax_refresh_county' %}",
          success: function(response)
            {
              const data = response.data
              console.log(data)
              // var resultObj = JSON.parse(response);
              var dataHandler = $("#countylist");
              var county_all = `<option style="text-align: center" value="全區">全區</option>`
              dataHandler.append(county_all);
              data.forEach(el =>
              {
                  var newRow = `<option style="text-align: center" value=${el.county}>${el.county}</option>`;
                  dataHandler.append(newRow);
              });
            }
          });
      }
      
      const weekday_select = document.getElementById('time_type_select')
      const select_continuous_time = document.getElementById('time_type_select')
      function continuous_timeSelect(){
        console.log('delete')
        select_continuous_time.innerHTML = ``
      }
      function WeekdaySelect(){
          weekday_select.innerHTML = ` 
                  <div class="row justify-content-start">
                    <div class="col-12 col-sm-3  inner title-font" >&emsp;每週時段</div>
                    <div class="col-12 col-sm-9 weekdayCheck">
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" id="1" name="weekdays[]" type="checkbox" value="1" {% if "1" in weekday_list %} checked="" {% endif %} />
                        <label class="h6" for="weekdays[]">星期一</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" id="2" name="weekdays[]" type="checkbox" value="2" {% if "2" in weekday_list %} checked="" {% endif %} />
                        <label class="h6" for="weekdays[]">星期二</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" id="3" name="weekdays[]" type="checkbox" value="3" {% if "3" in weekday_list %} checked="" {% endif %} />
                        <label class="h6" for="weekdays[]">星期三</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" id="4" name="weekdays[]" type="checkbox" value="4" {% if "4" in weekday_list %} checked="" {% endif %} />
                        <label class="h6" for="weekdays[]">星期四</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" id="5" name="weekdays[]" type="checkbox" value="5" {% if "5" in weekday_list %} checked="" {% endif %} />
                        <label class="h6" for="weekdays[]">星期五</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" id="6" name="weekdays[]" type="checkbox" value="6" {% if "6" in weekday_list %} checked="" {% endif %} />
                        <label class="h6" for="weekdays[]">星期六</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" id="0" name="weekdays[]" type="checkbox" value="0" {% if "0" in weekday_list %} checked="" {% endif %} />
                        <label class="h6" for="weekdays[]">星期日</label>
                      </div>
                    </div>
                  </div>
                  <hr size="4" class="mx-2" style="color: #BB6BD9;"/>
                   `
          document.querySelector('.weekdayCheck').addEventListener('change', event => {
            event.preventDefault();
            weekdays = []
            checkboxes = document.querySelectorAll('input[type=checkbox]:checked')

            for (var i = 0; i < checkboxes.length; i++) {
              weekdays.push(checkboxes[i].value)
                };
                console.log(weekdays)
          })
          weekdays.forEach(e =>{
            var element = document.getElementById(e)
            element.checked = true;
            console.log(element)
          })
          
          }

  </script>
       
</main>
 

 

{% endblock %}